{"version":3,"file":"index.es.js","sources":["../src/getRangeBoundingClientRect.ts","../src/getSelectionBoundingClientRect.ts","../src/usePopperPosition.ts"],"sourcesContent":["import { Range } from 'slate';\nimport { ReactEditor } from 'slate-react';\n\n/**\n * Get bounding client rect by slate range\n */\nexport const getRangeBoundingClientRect = (\n  editor: ReactEditor,\n  at: Range | null\n) => {\n  if (!at) return;\n\n  try {\n    const domRange = ReactEditor.toDOMRange(editor, at);\n    return domRange.getBoundingClientRect();\n  } catch (err) {}\n};\n","/**\n * Get bounding client rect of the window selection\n */\nexport const getSelectionBoundingClientRect = () => {\n  const domSelection = window.getSelection();\n  if (!domSelection || domSelection.rangeCount < 1) return;\n\n  const domRange = domSelection.getRangeAt(0);\n\n  return domRange.getBoundingClientRect();\n};\n","import React, { useCallback, useEffect } from 'react';\nimport { usePopper } from 'react-popper';\nimport * as PopperJS from '@popperjs/core';\nimport { Modifier } from '@popperjs/core';\nimport { getSelectionBoundingClientRect } from './getSelectionBoundingClientRect';\n\nexport type UsePopperOptions = Omit<Partial<PopperJS.Options>, 'modifiers'> & {\n  createPopper?: typeof PopperJS.createPopper;\n  modifiers?: ReadonlyArray<Partial<Modifier<string, object>>>;\n};\n\nexport interface UsePopperReturnType {\n  styles: { [key: string]: React.CSSProperties };\n  attributes: { [key: string]: { [key: string]: string } | undefined };\n  state: PopperJS.State | null;\n  update: PopperJS.Instance['update'] | null;\n  forceUpdate: PopperJS.Instance['forceUpdate'] | null;\n}\n\nexport interface UsePopperPositionOptions {\n  popperElement: HTMLElement | null;\n\n  /**\n   * Container element of editor popper,\n   * if no scroll container provided, it will take document.documentElement as scrolling container\n   */\n  popperContainer?: Document | HTMLElement | null;\n  popperOptions?: Partial<UsePopperOptions>;\n  modifiers?: UsePopperOptions['modifiers'];\n  placement?: PopperJS.Placement;\n  isHidden?: boolean;\n  getBoundingClientRect?: any;\n  offset?: number[];\n}\n\nexport const virtualReference: PopperJS.VirtualElement = {\n  getBoundingClientRect() {\n    return {\n      top: -9999,\n      left: -9999,\n      bottom: 9999,\n      right: 9999,\n      width: 90,\n      height: 10,\n      x: 0,\n      y: 0,\n      toJSON: () => null,\n    };\n  },\n};\n\n/**\n * TODO: duplicate\n */\nexport const usePopperPosition = ({\n  popperElement,\n  popperContainer = document,\n  popperOptions = {},\n  modifiers = [],\n  offset = [0, 0],\n  placement = 'auto',\n  isHidden = false,\n  getBoundingClientRect = getSelectionBoundingClientRect,\n}: UsePopperPositionOptions): UsePopperReturnType => {\n  const popperResult = usePopper(virtualReference, popperElement, {\n    placement,\n    modifiers: [\n      // default modifiers to position the popper correctly\n      {\n        name: 'preventOverflow',\n        enabled: true,\n        options: { boundary: popperContainer },\n      },\n      {\n        name: 'flip',\n        enabled: true,\n        options: { padding: 8 },\n      },\n      {\n        name: 'eventListeners',\n        enabled: true,\n        options: { scroll: !isHidden, resize: true },\n      },\n      {\n        name: 'offset',\n        options: {\n          offset,\n        },\n      },\n      {\n        name: 'computeStyles',\n        options: {\n          gpuAcceleration: false,\n        },\n      },\n      // user modifiers to override the default\n      ...modifiers,\n    ],\n    strategy: 'absolute',\n    ...popperOptions,\n  });\n\n  const { update, state } = popperResult;\n  const isReady = !isHidden && !!state;\n\n  const styles = isReady\n    ? popperResult.styles\n    : {\n        ...popperResult.styles,\n        popper: { ...popperResult.styles.popper, display: 'none' },\n      };\n\n  const updatePosition = useCallback((): any => {\n    if (isHidden) return;\n    if (!popperElement) return;\n\n    virtualReference.getBoundingClientRect = getBoundingClientRect;\n    update?.();\n  }, [getBoundingClientRect, isHidden, popperElement, update]);\n\n  useEffect(() => {\n    updatePosition();\n  }, [updatePosition]);\n\n  useEffect(() => {\n    popperContainer?.addEventListener('scroll', updatePosition);\n    return () => popperContainer?.removeEventListener('scroll', updatePosition);\n  }, [updatePosition, popperContainer]);\n\n  return { ...popperResult, update: updatePosition, styles };\n};\n"],"names":["getRangeBoundingClientRect","editor","at","domRange","ReactEditor","toDOMRange","getBoundingClientRect","err","getSelectionBoundingClientRect","domSelection","window","getSelection","rangeCount","getRangeAt","virtualReference","top","left","bottom","right","width","height","x","y","toJSON","usePopperPosition","popperElement","popperContainer","document","popperOptions","modifiers","offset","placement","isHidden","popperResult","usePopper","name","enabled","options","boundary","padding","scroll","resize","gpuAcceleration","strategy","update","state","isReady","styles","popper","display","updatePosition","useCallback","useEffect","addEventListener","removeEventListener"],"mappings":"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"}