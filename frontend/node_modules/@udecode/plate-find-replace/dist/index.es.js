import { createPluginFactory } from '@udecode/plate-core';
import { Text } from 'slate';

const decorateFindReplace = (editor, {
  type,
  options: {
    search
  }
}) => ([node, path]) => {
  const ranges = [];

  if (search && Text.isText(node)) {
    const {
      text
    } = node;
    const parts = text.split(search);
    let offset = 0;
    parts.forEach((part, i) => {
      if (i !== 0) {
        ranges.push({
          anchor: {
            path,
            offset: offset - search.length
          },
          focus: {
            path,
            offset
          },
          [type]: true
        });
      }

      offset = offset + part.length + search.length;
    });
  }

  return ranges;
};

const MARK_SEARCH_HIGHLIGHT = 'search_highlight';
const createFindReplacePlugin = createPluginFactory({
  key: MARK_SEARCH_HIGHLIGHT,
  isLeaf: true,
  decorate: decorateFindReplace
});

export { MARK_SEARCH_HIGHLIGHT, createFindReplacePlugin, decorateFindReplace };
//# sourceMappingURL=index.es.js.map
