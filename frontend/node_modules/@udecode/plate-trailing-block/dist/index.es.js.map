{"version":3,"file":"index.es.js","sources":["../src/withTrailingBlock.ts","../src/createTrailingBlockPlugin.ts"],"sourcesContent":["import {\n  getLastNode,\n  insertNodes,\n  queryNode,\n  TElement,\n  WithOverride,\n} from '@udecode/plate-core';\nimport { Path } from 'slate';\nimport { TrailingBlockPlugin } from './createTrailingBlockPlugin';\n\n/**\n * Add a trailing block when the last node type is not `type` and when the editor has .\n */\nexport const withTrailingBlock: WithOverride<{}, TrailingBlockPlugin> = (\n  editor,\n  { type, options: { level, ...query } }\n) => {\n  const { normalizeNode } = editor;\n\n  editor.normalizeNode = ([currentNode, currentPath]) => {\n    if (!currentPath.length) {\n      const lastChild = getLastNode(editor, level!);\n\n      const lastChildNode = lastChild?.[0];\n\n      if (\n        !lastChildNode ||\n        (lastChildNode.type !== type && queryNode(lastChild, query))\n      ) {\n        const at = lastChild ? Path.next(lastChild[1]) : [0];\n\n        insertNodes<TElement>(\n          editor,\n          {\n            type: type!,\n            children: [{ text: '' }],\n          },\n          { at }\n        );\n        return;\n      }\n    }\n\n    return normalizeNode([currentNode, currentPath]);\n  };\n\n  return editor;\n};\n","import {\n  createPluginFactory,\n  ELEMENT_DEFAULT,\n  getPluginType,\n  QueryNodeOptions,\n} from '@udecode/plate-core';\nimport { withTrailingBlock } from './withTrailingBlock';\n\nexport interface TrailingBlockPlugin extends QueryNodeOptions {\n  /**\n   * Level where the trailing node should be, the first level being 0.\n   */\n  level?: number;\n\n  /**\n   * Type of the trailing block\n   */\n  type?: string;\n}\n\nexport const KEY_TRAILING_BLOCK = 'trailingBlock';\n\n/**\n * @see {@link withTrailingNode}\n */\nexport const createTrailingBlockPlugin = createPluginFactory<TrailingBlockPlugin>(\n  {\n    key: KEY_TRAILING_BLOCK,\n    withOverrides: withTrailingBlock,\n    options: {\n      level: 0,\n    },\n    then: (editor) => ({\n      type: getPluginType(editor, ELEMENT_DEFAULT),\n    }),\n  }\n);\n"],"names":["withTrailingBlock","editor","type","options","level","query","normalizeNode","currentNode","currentPath","length","lastChild","getLastNode","lastChildNode","queryNode","at","Path","next","insertNodes","children","text","KEY_TRAILING_BLOCK","createTrailingBlockPlugin","createPluginFactory","key","withOverrides","then","getPluginType","ELEMENT_DEFAULT"],"mappings":";;;AAUA;AACA;AACA;MACaA,iBAAwD,GAAG,CACtEC,MADsE,EAEtE;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,OAAO,EAAE;AAAEC,IAAAA,KAAF;AAAS,OAAGC;AAAZ;AAAjB,CAFsE,KAGnE;AACH,QAAM;AAAEC,IAAAA;AAAF,MAAoBL,MAA1B;;AAEAA,EAAAA,MAAM,CAACK,aAAP,GAAuB,CAAC,CAACC,WAAD,EAAcC,WAAd,CAAD,KAAgC;AACrD,QAAI,CAACA,WAAW,CAACC,MAAjB,EAAyB;AACvB,YAAMC,SAAS,GAAGC,WAAW,CAACV,MAAD,EAASG,KAAT,CAA7B;AAEA,YAAMQ,aAAa,GAAGF,SAAH,aAAGA,SAAH,uBAAGA,SAAS,CAAG,CAAH,CAA/B;;AAEA,UACE,CAACE,aAAD,IACCA,aAAa,CAACV,IAAd,KAAuBA,IAAvB,IAA+BW,SAAS,CAACH,SAAD,EAAYL,KAAZ,CAF3C,EAGE;AACA,cAAMS,EAAE,GAAGJ,SAAS,GAAGK,IAAI,CAACC,IAAL,CAAUN,SAAS,CAAC,CAAD,CAAnB,CAAH,GAA6B,CAAC,CAAD,CAAjD;AAEAO,QAAAA,WAAW,CACThB,MADS,EAET;AACEC,UAAAA,IAAI,EAAEA,IADR;AAEEgB,UAAAA,QAAQ,EAAE,CAAC;AAAEC,YAAAA,IAAI,EAAE;AAAR,WAAD;AAFZ,SAFS,EAMT;AAAEL,UAAAA;AAAF,SANS,CAAX;AAQA;AACD;AACF;;AAED,WAAOR,aAAa,CAAC,CAACC,WAAD,EAAcC,WAAd,CAAD,CAApB;AACD,GAzBD;;AA2BA,SAAOP,MAAP;AACD;;MC3BYmB,kBAAkB,GAAG;AAElC;AACA;AACA;;MACaC,yBAAyB,GAAGC,mBAAmB,CAC1D;AACEC,EAAAA,GAAG,EAAEH,kBADP;AAEEI,EAAAA,aAAa,EAAExB,iBAFjB;AAGEG,EAAAA,OAAO,EAAE;AACPC,IAAAA,KAAK,EAAE;AADA,GAHX;AAMEqB,EAAAA,IAAI,EAAGxB,MAAD,KAAa;AACjBC,IAAAA,IAAI,EAAEwB,aAAa,CAACzB,MAAD,EAAS0B,eAAT;AADF,GAAb;AANR,CAD0D;;;;"}