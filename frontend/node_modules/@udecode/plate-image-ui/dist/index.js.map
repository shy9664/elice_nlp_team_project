{"version":3,"file":"index.js","sources":["../src/ImageElement/ImageElement.styles.ts","../src/ImageElement/ImageHandle.tsx","../src/ImageElement/ImageElement.tsx","../src/ImageToolbarButton/ImageToolbarButton.tsx"],"sourcesContent":["import { createStyles } from '@udecode/plate-styled-components';\nimport { css } from 'styled-components';\nimport tw from 'twin.macro';\nimport { ImageElementStyleProps } from './ImageElement.types';\n\nexport const getImageElementStyles = (props: ImageElementStyleProps) => {\n  const {\n    focused,\n    selected,\n    align,\n    caption = {\n      align: 'center',\n    },\n  } = props;\n\n  const handle = [\n    tw`flex flex-col justify-center absolute select-none`,\n    tw`w-6 h-full top-0 z-10`,\n    css`\n      ::after {\n        ${tw`opacity-0`};\n        ${focused && selected && tw`opacity-100`};\n        ${tw`group-hover:opacity-100`};\n        ${tw`flex`};\n        ${tw`bg-gray-400`};\n\n        content: ' ';\n        width: 3px;\n        height: 64px;\n        border-radius: 6px;\n      }\n\n      :hover,\n      :focus,\n      :active {\n        ::after {\n          ${tw`bg-blue-500`};\n        }\n      }\n    `,\n  ];\n\n  return createStyles(\n    { prefixClassNames: 'ImageElement', ...props },\n    {\n      root: [tw`py-2.5`],\n      resizable: [\n        align === 'center' && tw`mx-auto`,\n        align === 'right' && tw`ml-auto`,\n      ],\n      figure: [tw`m-0 relative`],\n      img: [\n        tw`block max-w-full px-0 cursor-pointer w-full`,\n        tw`borderRadius[3px] object-cover`,\n        focused && selected && tw`boxShadow[0 0 0 1px rgb(59,130,249)]`,\n      ],\n      figcaption: [\n        align === 'center' && tw`mx-auto`,\n        align === 'right' && tw`ml-auto`,\n      ],\n      caption: [\n        tw`w-full border-none focus:outline-none mt-2 p-0 resize-none`,\n        caption?.align === 'center' && tw`text-center`,\n        caption?.align === 'right' && tw`text-right`,\n        css`\n          font: inherit;\n          color: inherit;\n          background-color: inherit;\n\n          :focus {\n            ::placeholder {\n              opacity: 0;\n            }\n          }\n        `,\n      ],\n      handleLeft: [...handle, tw`-left-3 -ml-3 pl-3`],\n      handleRight: [...handle, tw`items-end -right-3 -mr-3 pr-3`],\n    }\n  );\n};\n","import React from 'react';\nimport { CSSProp } from 'styled-components';\n\nexport interface ImageHandleProps\n  extends React.DetailedHTMLProps<\n    React.HTMLAttributes<HTMLDivElement>,\n    HTMLDivElement\n  > {\n  css?: CSSProp;\n  className?: string;\n}\n\nexport const ImageHandle = (props: ImageHandleProps) => <div {...props} />;\n","import React, {\n  ChangeEventHandler,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'react';\nimport TextareaAutosize from 'react-textarea-autosize';\nimport { setNodes } from '@udecode/plate-core';\nimport { getRootProps } from '@udecode/plate-styled-components';\nimport { Resizable } from 're-resizable';\nimport { Node, Transforms } from 'slate';\nimport { ReactEditor, useFocused, useSelected } from 'slate-react';\nimport { getImageElementStyles } from './ImageElement.styles';\nimport { ImageElementProps } from './ImageElement.types';\nimport { ImageHandle } from './ImageHandle';\n\nexport const ImageElement = (props: ImageElementProps) => {\n  const {\n    attributes,\n    children,\n    element,\n    nodeProps,\n    caption = {},\n    resizableProps = {\n      minWidth: 92,\n    },\n    align = 'center',\n    draggable,\n    editor,\n  } = props;\n\n  const rootProps = getRootProps(props);\n\n  const { placeholder = 'Write a caption...' } = caption;\n\n  const {\n    url,\n    width: nodeWidth = '100%',\n    caption: nodeCaption = [{ children: [{ text: '' }] }],\n  } = element;\n  const focused = useFocused();\n  const selected = useSelected();\n  const [width, setWidth] = useState(nodeWidth);\n\n  // const [captionId] = useState(nanoid());\n\n  useEffect(() => {\n    setWidth(nodeWidth);\n  }, [nodeWidth]);\n\n  const styles = getImageElementStyles({ ...props, align, focused, selected });\n\n  const setNodeWidth = useCallback(\n    (w: number) => {\n      const path = ReactEditor.findPath(editor, element);\n\n      if (w === nodeWidth) {\n        // Focus the node if not resized\n        Transforms.select(editor, path);\n      } else {\n        setNodes(editor, { width: w }, { at: path });\n      }\n    },\n    [editor, element, nodeWidth]\n  );\n\n  const onChangeCaption: ChangeEventHandler<HTMLTextAreaElement> = useCallback(\n    (e) => {\n      const path = ReactEditor.findPath(editor as ReactEditor, element);\n      setNodes(editor, { caption: [{ text: e.target.value }] }, { at: path });\n    },\n    [editor, element]\n  );\n\n  const captionString = useMemo(() => {\n    return Node.string(nodeCaption[0]) || '';\n  }, [nodeCaption]);\n\n  return (\n    <div\n      {...attributes}\n      css={styles.root.css}\n      className={styles.root.className}\n      {...rootProps}\n      {...nodeProps}\n    >\n      <div contentEditable={false}>\n        <figure\n          css={styles.figure?.css}\n          className={`group ${styles.figure?.className}`}\n        >\n          <Resizable\n            // @ts-ignore\n            css={styles.resizable?.css}\n            className={styles.resizable?.className}\n            size={{ width, height: '100%' }}\n            maxWidth=\"100%\"\n            lockAspectRatio\n            resizeRatio={align === 'center' ? 2 : 1}\n            enable={{\n              left: ['center', 'left'].includes(align),\n              right: ['center', 'right'].includes(align),\n            }}\n            handleComponent={{\n              left: (\n                <ImageHandle\n                  css={[styles.handleLeft?.css]}\n                  className={styles.handleLeft?.className}\n                />\n              ),\n              right: (\n                <ImageHandle\n                  css={styles.handleRight?.css}\n                  className={styles.handleRight?.className}\n                />\n              ),\n            }}\n            handleStyles={{\n              left: { left: 0 },\n              right: { right: 0 },\n            }}\n            onResize={(e, direction, ref) => {\n              setWidth(ref.offsetWidth);\n            }}\n            onResizeStop={(e, direction, ref) => setNodeWidth(ref.offsetWidth)}\n            {...resizableProps}\n          >\n            <img\n              data-testid=\"ImageElementImage\"\n              css={styles.img?.css}\n              className={styles.img?.className}\n              src={url}\n              alt={captionString}\n              draggable={draggable}\n              {...nodeProps}\n            />\n          </Resizable>\n\n          {!caption.disabled && (captionString.length || selected) && (\n            <figcaption\n              style={{ width }}\n              css={styles.figcaption?.css}\n              className={styles.figcaption?.className}\n            >\n              <TextareaAutosize\n                css={styles.caption?.css}\n                className={styles.caption?.className}\n                value={nodeCaption[0].text}\n                placeholder={placeholder}\n                onChange={onChangeCaption}\n              />\n\n              {/* <div css={styles.caption?.css}> */}\n              {/*  <Plate */}\n              {/*    id={captionId} */}\n              {/*    plugins={plugins} */}\n              {/*    initialValue={nodeCaption} */}\n              {/*    value={nodeCaption} */}\n              {/*    editableProps={{ */}\n              {/*      placeholder, */}\n              {/*      className: styles.caption?.className, */}\n              {/*    }} */}\n              {/*    onChange={onChangeCaption} */}\n              {/*  /> */}\n              {/* </div> */}\n            </figcaption>\n          )}\n        </figure>\n      </div>\n      {children}\n    </div>\n  );\n};\n","import React from 'react';\nimport { usePlateEditorRef } from '@udecode/plate-core';\nimport { insertImage } from '@udecode/plate-image';\nimport { ToolbarButton, ToolbarButtonProps } from '@udecode/plate-toolbar';\n\nexport interface ImageToolbarButtonProps extends ToolbarButtonProps {\n  /**\n   * Default onMouseDown is getting the image url by calling this promise before inserting the image.\n   */\n  getImageUrl?: () => Promise<string>;\n}\n\nexport const ImageToolbarButton = ({\n  getImageUrl,\n  ...props\n}: ImageToolbarButtonProps) => {\n  const editor = usePlateEditorRef()!;\n\n  return (\n    <ToolbarButton\n      onMouseDown={async (event) => {\n        if (!editor) return;\n\n        event.preventDefault();\n\n        let url;\n        if (getImageUrl) {\n          url = await getImageUrl();\n        } else {\n          url = window.prompt('Enter the URL of the image:');\n        }\n        if (!url) return;\n\n        insertImage(editor, url);\n      }}\n      {...props}\n    />\n  );\n};\n"],"names":["getImageElementStyles","props","focused","selected","align","caption","handle","css","createStyles","prefixClassNames","root","resizable","figure","img","figcaption","handleLeft","handleRight","ImageHandle","React","ImageElement","attributes","children","element","nodeProps","resizableProps","minWidth","draggable","editor","rootProps","getRootProps","placeholder","url","width","nodeWidth","nodeCaption","text","useFocused","useSelected","setWidth","useState","useEffect","styles","setNodeWidth","useCallback","w","path","ReactEditor","findPath","Transforms","select","setNodes","at","onChangeCaption","e","target","value","captionString","useMemo","Node","string","className","height","left","includes","right","direction","ref","offsetWidth","disabled","length","ImageToolbarButton","getImageUrl","usePlateEditorRef","ToolbarButton","event","preventDefault","window","prompt","insertImage"],"mappings":"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"}