{"version":3,"file":"index.js","sources":["../src/combobox.store.ts","../src/utils/getTextFromTrigger.ts","../src/onChangeCombobox.ts","../src/utils/getNextNonDisabledIndex.ts","../src/utils/getNextWrappingIndex.ts","../src/onKeyDownCombobox.ts","../src/createComboboxPlugin.ts","../src/components/Combobox.styles.ts","../src/hooks/useComboboxControls.ts","../src/components/Combobox.tsx"],"sourcesContent":["import { UsePopperOptions } from '@udecode/plate-popper';\nimport { createStore, StateActions, StoreApi } from '@udecode/zustood';\nimport { Range } from 'slate';\nimport { NoData, TComboboxItem } from './components';\nimport { ComboboxOnSelectItem } from './types';\n\nexport type ComboboxStateById<TData = NoData> = {\n  /**\n   * Combobox id.\n   */\n  id: string;\n\n  /**\n   * Items filter function by text.\n   * @default (value) => value.text.toLowerCase().startsWith(search.toLowerCase())\n   */\n  filter?: (search: string) => (item: TComboboxItem<TData>) => boolean;\n\n  /**\n   * Max number of items.\n   * @default items.length\n   */\n  maxSuggestions?: number;\n\n  /**\n   * Trigger that activates the combobox.\n   */\n  trigger: string;\n\n  /**\n   * Regular expression for search, for example to allow whitespace\n   */\n  searchPattern?: string;\n\n  /**\n   * Called when an item is selected.\n   */\n  onSelectItem: ComboboxOnSelectItem<TData> | null;\n\n  /**\n   * Is opening/closing the combobox controlled by the client.\n   */\n  controlled?: boolean;\n};\n\nexport type ComboboxStoreById<TData = NoData> = StoreApi<\n  string,\n  ComboboxStateById<TData>,\n  StateActions<ComboboxStateById<TData>>\n>;\n\nexport type ComboboxState<TData = NoData> = {\n  /**\n   * Active id (combobox id which is opened).\n   */\n  activeId: string | null;\n\n  /**\n   * Object whose keys are combobox ids and values are config stores\n   * (e.g. one for tag, one for mention,...).\n   */\n  byId: Record<string, ComboboxStoreById>;\n\n  /**\n   * Unfiltered items.\n   */\n  items: TComboboxItem<TData>[];\n\n  /**\n   * Filtered items\n   */\n  filteredItems: TComboboxItem<TData>[];\n\n  /**\n   * Highlighted index.\n   */\n  highlightedIndex: number;\n\n  /**\n   * Parent element of the popper element (the one that has the scroll).\n   * @default document\n   */\n  popperContainer?: Document | HTMLElement;\n\n  /**\n   * Overrides `usePopper` options.\n   */\n  popperOptions?: UsePopperOptions;\n\n  /**\n   * Range from the trigger to the cursor.\n   */\n  targetRange: Range | null;\n\n  /**\n   * Text after the trigger.\n   */\n  text: string | null;\n};\n\nconst createComboboxStore = (state: ComboboxStateById) =>\n  createStore(`combobox-${state.id}`)(state);\n\nexport const comboboxStore = createStore('combobox')<ComboboxState>({\n  activeId: null,\n  byId: {},\n  highlightedIndex: 0,\n  items: [],\n  filteredItems: [],\n  targetRange: null,\n  text: null,\n})\n  .extendActions((set, get) => ({\n    setComboboxById: <TData = NoData>(state: ComboboxStateById<TData>) => {\n      if (get.byId()[state.id]) return;\n\n      set.state((draft) => {\n        draft.byId[state.id] = createComboboxStore(\n          (state as unknown) as ComboboxStateById\n        );\n      });\n    },\n    open: (state: Pick<ComboboxState, 'activeId' | 'targetRange' | 'text'>) => {\n      set.mergeState(state);\n    },\n    reset: () => {\n      set.state((draft) => {\n        draft.activeId = null;\n        draft.highlightedIndex = 0;\n        draft.items = [];\n        draft.text = null;\n        draft.targetRange = null;\n      });\n    },\n  }))\n  .extendSelectors((state) => ({\n    isOpen: () => !!state.activeId,\n  }));\n\nexport const getComboboxStoreById = (id: string | null) =>\n  id ? comboboxStore.get.byId()[id] : null;\n\nexport const useActiveComboboxStore = () => {\n  const activeId = comboboxStore.use.activeId();\n  const comboboxes = comboboxStore.use.byId();\n\n  return activeId ? comboboxes[activeId] : null;\n};\n","import { escapeRegExp, getText } from '@udecode/plate-core';\nimport { Editor, Point } from 'slate';\n\n/**\n * Get text and range from trigger to cursor.\n * Starts with trigger and ends with non-whitespace character.\n */\nexport const getTextFromTrigger = (\n  editor: Editor,\n  {\n    at,\n    trigger,\n    searchPattern = `\\\\S+`,\n  }: { at: Point; trigger: string; searchPattern?: string }\n) => {\n  const escapedTrigger = escapeRegExp(trigger);\n  const triggerRegex = new RegExp(`(?:^|\\\\s)${escapedTrigger}`);\n\n  let start: Point | undefined = at;\n  let end: Point | undefined;\n\n  while (true) {\n    end = start;\n\n    if (!start) break;\n\n    start = Editor.before(editor, start);\n    const charRange = start && Editor.range(editor, start, end);\n    const charText = getText(editor, charRange);\n\n    if (!charText.match(searchPattern)) {\n      start = end;\n      break;\n    }\n  }\n\n  // Range from start to cursor\n  const range = start && Editor.range(editor, start, at);\n  const text = getText(editor, range);\n\n  if (!range || !text.match(triggerRegex)) return;\n\n  return {\n    range,\n    textAfterTrigger: text.substring(1),\n  };\n};\n\n// export const matchesTriggerAndPattern = (\n//   editor: TEditor,\n//   { at, trigger, pattern }: { at: Point; trigger: string; pattern: string }\n// ) => {\n//   // Point at the start of line\n//   const lineStart = Editor.before(editor, at, { unit: 'line' });\n//\n//   // Range from before to start\n//   const beforeRange = lineStart && Editor.range(editor, lineStart, at);\n//\n//   // Before text\n//   const beforeText = getText(editor, beforeRange);\n//\n//   // Starts with char and ends with word characters\n//   const escapedTrigger = escapeRegExp(trigger);\n//\n//   const beforeRegex = new RegExp(`(?:^|\\\\s)${escapedTrigger}(${pattern})$`);\n//\n//   // Match regex on before text\n//   const match = !!beforeText && beforeText.match(beforeRegex);\n//\n//   // Point at the start of mention\n//   const mentionStart = match\n//     ? Editor.before(editor, at, {\n//         unit: 'character',\n//         distance: match[1].length + trigger.length,\n//       })\n//     : null;\n//\n//   // Range from mention to start\n//   const mentionRange = mentionStart && Editor.range(editor, mentionStart, at);\n//\n//   return {\n//     range: mentionRange,\n//     match,\n//   };\n// };\n","import { isCollapsed, OnChange } from '@udecode/plate-core';\nimport { Range } from 'slate';\nimport { getTextFromTrigger } from './utils/getTextFromTrigger';\nimport { comboboxStore } from './combobox.store';\n\n/**\n * For each combobox state (byId):\n * - if the selection is collapsed\n * - if the cursor follows the trigger\n * - if there is text without whitespaces after the trigger\n * - open the combobox: set id, search, targetRange in the store\n * Close the combobox if needed\n */\nexport const onChangeCombobox: OnChange = (editor) => () => {\n  const byId = comboboxStore.get.byId();\n  const activeId = comboboxStore.get.activeId();\n\n  let shouldClose = true;\n\n  for (const store of Object.values(byId)) {\n    const id = store.get.id();\n    const controlled = store.get.controlled?.();\n\n    if (controlled) {\n      // do not close controlled comboboxes\n      if (activeId === id) {\n        shouldClose = false;\n        break;\n      } else {\n        // do not open controlled comboboxes\n        continue;\n      }\n    }\n\n    const { selection } = editor;\n    if (!selection || !isCollapsed(selection)) {\n      continue;\n    }\n\n    const trigger = store.get.trigger();\n    const searchPattern = store.get.searchPattern?.();\n\n    const isCursorAfterTrigger = getTextFromTrigger(editor, {\n      at: Range.start(selection),\n      trigger,\n      searchPattern,\n    });\n    if (!isCursorAfterTrigger) {\n      continue;\n    }\n\n    const { range, textAfterTrigger } = isCursorAfterTrigger;\n\n    comboboxStore.set.open({\n      activeId: id,\n      text: textAfterTrigger,\n      targetRange: range,\n    });\n\n    shouldClose = false;\n    break;\n  }\n\n  if (shouldClose && comboboxStore.get.isOpen()) {\n    comboboxStore.set.reset();\n  }\n};\n","/**\n * Returns the next index in the list of an item that is not disabled.\n *\n * @param {number} moveAmount Number of positions to move. Negative to move backwards, positive forwards.\n * @param {number} baseIndex The initial position to move from.\n * @param {number} itemCount The total number of items.\n * @param {Function} getItemNodeFromIndex Used to check if item is disabled.\n * @param {boolean} circular Specify if navigation is circular. Default is true.\n * @returns {number} The new index. Returns baseIndex if item is not disabled. Returns next non-disabled item otherwise. If no non-disabled found it will return -1.\n */\nexport const getNextNonDisabledIndex = (\n  moveAmount: number,\n  baseIndex: number,\n  itemCount: number,\n  getItemNodeFromIndex: any,\n  circular: boolean\n): number => {\n  const currentElementNode = getItemNodeFromIndex(baseIndex);\n  if (!currentElementNode || !currentElementNode.hasAttribute('disabled')) {\n    return baseIndex;\n  }\n\n  if (moveAmount > 0) {\n    for (let index = baseIndex + 1; index < itemCount; index++) {\n      if (!getItemNodeFromIndex(index).hasAttribute('disabled')) {\n        return index;\n      }\n    }\n  } else {\n    for (let index = baseIndex - 1; index >= 0; index--) {\n      if (!getItemNodeFromIndex(index).hasAttribute('disabled')) {\n        return index;\n      }\n    }\n  }\n\n  if (circular) {\n    return moveAmount > 0\n      ? getNextNonDisabledIndex(1, 0, itemCount, getItemNodeFromIndex, false)\n      : getNextNonDisabledIndex(\n          -1,\n          itemCount - 1,\n          itemCount,\n          getItemNodeFromIndex,\n          false\n        );\n  }\n\n  return -1;\n};\n","import { getNextNonDisabledIndex } from './getNextNonDisabledIndex';\n\n/**\n * Returns the new index in the list, in a circular way. If next value is out of bonds from the total,\n * it will wrap to either 0 or itemCount - 1.\n *\n * @param {number} moveAmount Number of positions to move. Negative to move backwards, positive forwards.\n * @param {number} baseIndex The initial position to move from.\n * @param {number} itemCount The total number of items.\n * @param {Function} getItemNodeFromIndex Used to check if item is disabled.\n * @param {boolean} circular Specify if navigation is circular. Default is true.\n * @returns {number} The new index after the move.\n */\nexport const getNextWrappingIndex = (\n  moveAmount: number,\n  baseIndex: number,\n  itemCount: number,\n  getItemNodeFromIndex: any,\n  circular = true\n) => {\n  if (itemCount === 0) {\n    return -1;\n  }\n\n  const itemsLastIndex = itemCount - 1;\n\n  // noinspection SuspiciousTypeOfGuard\n  if (\n    typeof baseIndex !== 'number' ||\n    baseIndex < 0 ||\n    baseIndex >= itemCount\n  ) {\n    baseIndex = moveAmount > 0 ? -1 : itemsLastIndex + 1;\n  }\n\n  let newIndex = baseIndex + moveAmount;\n\n  if (newIndex < 0) {\n    newIndex = circular ? itemsLastIndex : 0;\n  } else if (newIndex > itemsLastIndex) {\n    newIndex = circular ? 0 : itemsLastIndex;\n  }\n\n  const nonDisabledNewIndex = getNextNonDisabledIndex(\n    moveAmount,\n    newIndex,\n    itemCount,\n    getItemNodeFromIndex,\n    circular\n  );\n\n  if (nonDisabledNewIndex === -1) {\n    return baseIndex >= itemCount ? -1 : baseIndex;\n  }\n\n  return nonDisabledNewIndex;\n};\n","import { KeyboardHandler } from '@udecode/plate-core';\nimport { getNextWrappingIndex } from './utils/getNextWrappingIndex';\nimport { comboboxStore, getComboboxStoreById } from './combobox.store';\n\n/**\n * If the combobox is open, handle:\n * - down (next item)\n * - up (previous item)\n * - escape (reset combobox)\n * - tab, enter (select item)\n */\nexport const onKeyDownCombobox: KeyboardHandler = (editor) => (event) => {\n  const {\n    highlightedIndex,\n    filteredItems,\n    activeId,\n  } = comboboxStore.get.state();\n  const isOpen = comboboxStore.get.isOpen();\n\n  if (!isOpen) return;\n\n  const store = getComboboxStoreById(activeId);\n  if (!store) return;\n\n  const onSelectItem = store.get.onSelectItem();\n\n  if (event.key === 'ArrowDown') {\n    event.preventDefault();\n\n    const newIndex = getNextWrappingIndex(\n      1,\n      highlightedIndex,\n      filteredItems.length,\n      () => {},\n      true\n    );\n    comboboxStore.set.highlightedIndex(newIndex);\n    return;\n  }\n  if (event.key === 'ArrowUp') {\n    event.preventDefault();\n\n    const newIndex = getNextWrappingIndex(\n      -1,\n      highlightedIndex,\n      filteredItems.length,\n      () => {},\n      true\n    );\n    comboboxStore.set.highlightedIndex(newIndex);\n    return;\n  }\n  if (event.key === 'Escape') {\n    event.preventDefault();\n    comboboxStore.set.reset();\n    return;\n  }\n\n  if (['Tab', 'Enter'].includes(event.key)) {\n    event.preventDefault();\n    if (filteredItems[highlightedIndex]) {\n      onSelectItem?.(editor, filteredItems[highlightedIndex]);\n    }\n  }\n};\n","import { createPluginFactory } from '@udecode/plate-core';\nimport { onChangeCombobox } from './onChangeCombobox';\nimport { onKeyDownCombobox } from './onKeyDownCombobox';\n\nexport const KEY_COMBOBOX = 'combobox';\n\nexport const createComboboxPlugin = createPluginFactory({\n  key: KEY_COMBOBOX,\n  handlers: {\n    onChange: onChangeCombobox,\n    onKeyDown: onKeyDownCombobox,\n  },\n});\n","import { createStyles } from '@udecode/plate-styled-components';\nimport { css } from 'styled-components';\nimport tw from 'twin.macro';\nimport { ComboboxStyleProps, Data } from './Combobox.types';\n\nexport const getComboboxStyles = <TData extends Data>(\n  props: ComboboxStyleProps<TData>\n) => {\n  const item = [\n    tw`flex items-center px-2 cursor-pointer`,\n    css`\n      font-size: 14px;\n      border-radius: 0;\n      min-height: 36px;\n      user-select: none;\n      color: rgb(32, 31, 30);\n    `,\n  ];\n\n  return createStyles({ prefixClassNames: 'Combobox', ...props }, [\n    {\n      root: [\n        tw`bg-white m-0 p-0 overflow-scroll`,\n        css`\n          width: 300px;\n          max-height: 288px;\n          border-radius: 0 0 2px 2px;\n          box-shadow: rgba(0, 0, 0, 0.133) 0 3.2px 7.2px 0,\n            rgba(0, 0, 0, 0.11) 0 0.6px 1.8px 0;\n\n          z-index: 500;\n        `,\n      ],\n      item: [\n        ...item,\n        css`\n          background: transparent;\n\n          :hover {\n            background: rgb(243, 242, 241);\n          }\n        `,\n      ],\n      highlightedItem: [\n        ...item,\n        css`\n          background: rgb(237, 235, 233);\n\n          :hover {\n            background: rgb(237, 235, 233);\n          }\n        `,\n      ],\n    },\n  ]);\n};\n","import { useMemo } from 'react';\nimport { useCombobox } from 'downshift';\nimport { comboboxStore } from '../combobox.store';\n\nexport const useComboboxControls = () => {\n  const isOpen = comboboxStore.use.isOpen();\n  const highlightedIndex = comboboxStore.use.highlightedIndex();\n  const filteredItems = comboboxStore.use.filteredItems();\n\n  const {\n    closeMenu,\n    getMenuProps,\n    getComboboxProps,\n    getInputProps,\n    getItemProps,\n  } = useCombobox({\n    isOpen,\n    highlightedIndex,\n    items: filteredItems,\n    circularNavigation: true,\n  });\n  getMenuProps({}, { suppressRefError: true });\n  getComboboxProps({}, { suppressRefError: true });\n  getInputProps({}, { suppressRefError: true });\n\n  return useMemo(\n    () => ({\n      closeMenu,\n      getMenuProps,\n      getItemProps,\n    }),\n    [closeMenu, getItemProps, getMenuProps]\n  );\n};\n","import React, { useCallback, useEffect } from 'react';\nimport {\n  isDefined,\n  useEditorState,\n  usePlateEventId,\n} from '@udecode/plate-core';\nimport {\n  getRangeBoundingClientRect,\n  usePopperPosition,\n  virtualReference,\n} from '@udecode/plate-popper';\nimport { PortalBody } from '@udecode/plate-styled-components';\nimport {\n  comboboxStore,\n  getComboboxStoreById,\n  useActiveComboboxStore,\n} from '../combobox.store';\nimport { useComboboxControls } from '../hooks';\nimport { getComboboxStyles } from './Combobox.styles';\nimport { ComboboxProps, Data, NoData, TComboboxItem } from './Combobox.types';\n\nconst ComboboxContent = <TData extends Data = NoData>(\n  props: Pick<ComboboxProps<TData>, 'component' | 'items' | 'onRenderItem'>\n) => {\n  const { component: Component, items, onRenderItem } = props;\n\n  const targetRange = comboboxStore.use.targetRange();\n  const filteredItems = comboboxStore.use.filteredItems();\n  const highlightedIndex = comboboxStore.use.highlightedIndex();\n  const popperContainer = comboboxStore.use.popperContainer?.();\n  const popperOptions = comboboxStore.use.popperOptions?.();\n  const editor = useEditorState();\n  const combobox = useComboboxControls();\n  const activeComboboxStore = useActiveComboboxStore()!;\n  const text = comboboxStore.use.text();\n  const storeItems = comboboxStore.use.items();\n  const filter = activeComboboxStore.use.filter?.();\n  const maxSuggestions =\n    activeComboboxStore.use.maxSuggestions?.() ?? storeItems.length;\n\n  const popperRef = React.useRef<any>(null);\n\n  // Update items\n  useEffect(() => {\n    items && comboboxStore.set.items(items);\n  }, [items]);\n\n  // Filter items\n  useEffect(() => {\n    if (!isDefined(text)) return;\n\n    if (text.length === 0) {\n      return comboboxStore.set.filteredItems(\n        storeItems.slice(0, maxSuggestions)\n      );\n    }\n\n    const _filteredItems = storeItems\n      .filter(\n        filter\n          ? filter(text)\n          : (value) => value.text.toLowerCase().startsWith(text.toLowerCase())\n      )\n      .slice(0, maxSuggestions);\n\n    comboboxStore.set.filteredItems(_filteredItems);\n  }, [filter, storeItems, maxSuggestions, text]);\n\n  // Get target range rect\n  const getBoundingClientRect = useCallback(\n    () => getRangeBoundingClientRect(editor, targetRange) ?? virtualReference,\n    [editor, targetRange]\n  );\n\n  // Update popper position\n  const { styles: popperStyles, attributes } = usePopperPosition({\n    popperElement: popperRef.current,\n    popperContainer,\n    popperOptions,\n    placement: 'bottom-start',\n    getBoundingClientRect,\n    offset: [0, 4],\n  });\n\n  const menuProps = combobox\n    ? combobox.getMenuProps({}, { suppressRefError: true })\n    : { ref: null };\n\n  const { root, item: styleItem, highlightedItem } = getComboboxStyles(\n    props as any\n  );\n\n  return (\n    <PortalBody>\n      <ul\n        {...menuProps}\n        ref={popperRef}\n        style={popperStyles.popper}\n        css={root.css}\n        className={root.className}\n        {...attributes.popper}\n      >\n        {Component ? Component({ store: activeComboboxStore }) : null}\n\n        {filteredItems.map((item, index) => {\n          const Item = onRenderItem\n            ? onRenderItem({ item: item as TComboboxItem<TData> })\n            : item.text;\n\n          const highlighted = index === highlightedIndex;\n\n          return (\n            <div\n              key={item.key}\n              css={!highlighted ? styleItem?.css : highlightedItem?.css}\n              className={\n                !highlighted ? styleItem?.className : highlightedItem?.css\n              }\n              {...combobox.getItemProps({\n                item,\n                index,\n              })}\n              onMouseDown={(e) => {\n                e.preventDefault();\n\n                const onSelectItem = getComboboxStoreById(\n                  comboboxStore.get.activeId()\n                )?.get.onSelectItem();\n                onSelectItem?.(editor, item);\n              }}\n            >\n              {Item}\n            </div>\n          );\n        })}\n      </ul>\n    </PortalBody>\n  );\n};\n\n/**\n * Register the combobox id, trigger, onSelectItem\n * Renders the combobox if active.\n */\nexport const Combobox = <TData extends Data = NoData>({\n  id,\n  trigger,\n  searchPattern,\n  onSelectItem,\n  controlled,\n  ...props\n}: ComboboxProps<TData>) => {\n  const editor = useEditorState();\n  const focusedEditorId = usePlateEventId('focus');\n  const combobox = useComboboxControls();\n  const activeId = comboboxStore.use.activeId();\n\n  useEffect(() => {\n    comboboxStore.set.setComboboxById({\n      id,\n      trigger,\n      searchPattern,\n      controlled,\n      onSelectItem,\n    });\n  }, [id, trigger, searchPattern, controlled, onSelectItem]);\n\n  if (\n    !combobox ||\n    !editor.selection ||\n    focusedEditorId !== editor.id ||\n    activeId !== id\n  ) {\n    return null;\n  }\n\n  return <ComboboxContent {...props} />;\n};\n"],"names":["createComboboxStore","state","createStore","id","comboboxStore","activeId","byId","highlightedIndex","items","filteredItems","targetRange","text","extendActions","set","get","setComboboxById","draft","open","mergeState","reset","extendSelectors","isOpen","getComboboxStoreById","useActiveComboboxStore","use","comboboxes","getTextFromTrigger","editor","at","trigger","searchPattern","escapedTrigger","escapeRegExp","triggerRegex","RegExp","start","end","Editor","before","charRange","range","charText","getText","match","textAfterTrigger","substring","onChangeCombobox","shouldClose","store","Object","values","controlled","selection","isCollapsed","isCursorAfterTrigger","Range","getNextNonDisabledIndex","moveAmount","baseIndex","itemCount","getItemNodeFromIndex","circular","currentElementNode","hasAttribute","index","getNextWrappingIndex","itemsLastIndex","newIndex","nonDisabledNewIndex","onKeyDownCombobox","event","onSelectItem","key","preventDefault","length","includes","KEY_COMBOBOX","createComboboxPlugin","createPluginFactory","handlers","onChange","onKeyDown","getComboboxStyles","props","item","css","createStyles","prefixClassNames","root","highlightedItem","useComboboxControls","closeMenu","getMenuProps","getComboboxProps","getInputProps","getItemProps","useCombobox","circularNavigation","suppressRefError","useMemo","ComboboxContent","component","Component","onRenderItem","popperContainer","popperOptions","useEditorState","combobox","activeComboboxStore","storeItems","filter","maxSuggestions","popperRef","React","useRef","useEffect","isDefined","slice","_filteredItems","value","toLowerCase","startsWith","getBoundingClientRect","useCallback","getRangeBoundingClientRect","virtualReference","styles","popperStyles","attributes","usePopperPosition","popperElement","current","placement","offset","menuProps","ref","styleItem","PortalBody","popper","className","map","Item","highlighted","e","Combobox","focusedEditorId","usePlateEventId"],"mappings":"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"}