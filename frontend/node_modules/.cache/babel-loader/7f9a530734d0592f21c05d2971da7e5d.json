{"ast":null,"code":"import { createPluginFactory, onKeyDownToggleMark, findHtmlParentElement, getPluginType, isUrl } from '@udecode/plate-core';\nimport { ELEMENT_BLOCKQUOTE } from '@udecode/plate-block-quote';\nimport { ELEMENT_CODE_BLOCK } from '@udecode/plate-code-block';\nimport { ELEMENT_H1, ELEMENT_H2, ELEMENT_H3, ELEMENT_H4, ELEMENT_H5, ELEMENT_H6 } from '@udecode/plate-heading';\nimport { ELEMENT_LINK } from '@udecode/plate-link';\nimport { ELEMENT_UL, ELEMENT_OL, ELEMENT_LI } from '@udecode/plate-list';\nimport { ELEMENT_PARAGRAPH } from '@udecode/plate-paragraph';\nimport markdown from 'remark-parse';\nimport slate from 'remark-slate';\nimport unified from 'unified';\nconst deserializeHtmlBold = [{\n  validNodeName: ['STRONG', 'B']\n}, {\n  validStyle: {\n    fontWeight: ['600', '700', 'bold']\n  }\n}];\nconst MARK_BOLD = 'bold';\n/**\n * Enables support for bold formatting\n */\n\nconst createBoldPlugin = createPluginFactory({\n  key: MARK_BOLD,\n  isLeaf: true,\n  deserializeHtml: deserializeHtmlBold,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+b'\n  }\n});\nconst MARK_CODE = 'code';\n/**\n * Enables support for code formatting\n */\n\nconst createCodePlugin = createPluginFactory({\n  key: MARK_CODE,\n  isLeaf: true,\n  deserializeHtml: [{\n    validNodeName: ['CODE'],\n    query: el => !findHtmlParentElement(el, 'PRE')\n  }, {\n    validStyle: {\n      wordWrap: 'break-word'\n    }\n  }, {\n    validStyle: {\n      fontFamily: 'Consolas'\n    }\n  }],\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+e'\n  }\n});\nconst deserializeHtmlItalic = [{\n  validNodeName: ['EM', 'I']\n}, {\n  validStyle: {\n    fontStyle: 'italic'\n  }\n}];\nconst MARK_ITALIC = 'italic';\n/**\n * Enables support for italic formatting.\n */\n\nconst createItalicPlugin = createPluginFactory({\n  key: MARK_ITALIC,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+i'\n  },\n  deserializeHtml: deserializeHtmlItalic\n});\nconst MARK_STRIKETHROUGH = 'strikethrough';\n/**\n * Enables support for strikethrough formatting.\n */\n\nconst createStrikethroughPlugin = createPluginFactory({\n  key: MARK_STRIKETHROUGH,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+shift+x'\n  },\n  deserializeHtml: [{\n    validNodeName: ['S', 'DEL', 'STRIKE']\n  }, {\n    validStyle: {\n      textDecoration: 'line-through'\n    }\n  }]\n});\nconst MARK_SUBSCRIPT$1 = 'subscript';\nconst MARK_SUPERSCRIPT$1 = 'superscript';\n/**\n * Enables support for subscript formatting.\n */\n\nconst createSubscriptPlugin = createPluginFactory({\n  key: MARK_SUBSCRIPT$1,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+,',\n    clear: MARK_SUPERSCRIPT$1\n  },\n  deserializeHtml: [{\n    validNodeName: ['SUB']\n  }, {\n    validStyle: {\n      verticalAlign: 'sub'\n    }\n  }]\n});\nconst MARK_SUPERSCRIPT = 'superscript';\nconst MARK_SUBSCRIPT = 'subscript';\n/**\n * Enables support for superscript formatting.\n */\n\nconst createSuperscriptPlugin = createPluginFactory({\n  key: MARK_SUPERSCRIPT,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+.',\n    clear: MARK_SUBSCRIPT\n  },\n  deserializeHtml: [{\n    validNodeName: ['SUP']\n  }, {\n    validStyle: {\n      verticalAlign: 'super'\n    }\n  }]\n});\nconst MARK_UNDERLINE = 'underline';\n/**\n * Enables support for underline formatting.\n */\n\nconst createUnderlinePlugin = createPluginFactory({\n  key: MARK_UNDERLINE,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+u'\n  },\n  deserializeHtml: [{\n    validNodeName: ['U']\n  }, {\n    validStyle: {\n      textDecoration: 'underline'\n    }\n  }]\n});\n/**\n * Enables support for basic marks:\n * - Bold\n * - Code\n * - Italic\n * - Strikethrough\n * - Subscript\n * - Superscript\n * - Underline\n */\n\ncreatePluginFactory({\n  key: 'basicMarks',\n  plugins: [createBoldPlugin(), createCodePlugin(), createItalicPlugin(), createStrikethroughPlugin(), createSubscriptPlugin(), createSuperscriptPlugin(), createUnderlinePlugin()]\n});\n/**\n * Deserialize content from Markdown format to Slate format.\n * `editor` needs\n */\n\nconst deserializeMd = (editor, data) => {\n  const tree = unified().use(markdown).use(slate, {\n    nodeTypes: {\n      paragraph: getPluginType(editor, ELEMENT_PARAGRAPH),\n      block_quote: getPluginType(editor, ELEMENT_BLOCKQUOTE),\n      link: getPluginType(editor, ELEMENT_LINK),\n      inline_code_mark: getPluginType(editor, MARK_CODE),\n      emphasis_mark: getPluginType(editor, MARK_ITALIC),\n      strong_mark: getPluginType(editor, MARK_BOLD),\n      delete_mark: getPluginType(editor, MARK_STRIKETHROUGH),\n      // FIXME: underline, subscript superscript not yet supported by remark-slate\n      // underline: getPluginType(editor, MARK_UNDERLINE),\n      // subscript: getPluginType(editor, MARK_SUBSCRIPT),\n      // superscript: getPluginType(editor, MARK_SUPERSCRIPT),\n      code_block: getPluginType(editor, ELEMENT_CODE_BLOCK),\n      ul_list: getPluginType(editor, ELEMENT_UL),\n      ol_list: getPluginType(editor, ELEMENT_OL),\n      listItem: getPluginType(editor, ELEMENT_LI),\n      heading: {\n        1: getPluginType(editor, ELEMENT_H1),\n        2: getPluginType(editor, ELEMENT_H2),\n        3: getPluginType(editor, ELEMENT_H3),\n        4: getPluginType(editor, ELEMENT_H4),\n        5: getPluginType(editor, ELEMENT_H5),\n        6: getPluginType(editor, ELEMENT_H6)\n      }\n    },\n    linkDestinationKey: 'url'\n  }).processSync(data);\n  return tree.result;\n};\n\nfunction filterBreaklines(item) {\n  return !item.text;\n}\n\nconst KEY_DESERIALIZE_MD = 'deserializeMd';\nconst createDeserializeMdPlugin = createPluginFactory({\n  key: KEY_DESERIALIZE_MD,\n  then: editor => ({\n    editor: {\n      insertData: {\n        format: 'text/plain',\n        query: ({\n          data,\n          dataTransfer\n        }) => {\n          const htmlData = dataTransfer.getData('text/html');\n          if (htmlData) return false;\n          const {\n            files\n          } = dataTransfer;\n\n          if (!(files !== null && files !== void 0 && files.length)) {\n            // if content is simply a URL pass through to not break LinkPlugin\n            if (isUrl(data)) {\n              return false;\n            }\n          }\n\n          return true;\n        },\n        getFragment: ({\n          data\n        }) => deserializeMd(editor, data)\n      }\n    }\n  })\n});\nexport { KEY_DESERIALIZE_MD, createDeserializeMdPlugin, deserializeMd, filterBreaklines };","map":{"version":3,"sources":["../../../marks/basic-marks/dist/index.es.js","../src/deserializer/utils/deserializeMd.ts","../src/deserializer/utils/filterBreakLines.ts","../src/deserializer/createDeserializeMdPlugin.ts"],"names":["deserializeHtmlBold","validNodeName","validStyle","fontWeight","deserializeMd","tree","nodeTypes","paragraph","getPluginType","block_quote","link","inline_code_mark","emphasis_mark","strong_mark","delete_mark","code_block","ul_list","ol_list","listItem","heading","linkDestinationKey","item","KEY_DESERIALIZE_MD","createDeserializeMdPlugin","createPluginFactory","key","then","editor","insertData","format","query","dataTransfer","htmlData","files","isUrl","getFragment","data"],"mappings":"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","sourcesContent":["import { createPluginFactory, onKeyDownToggleMark, findHtmlParentElement } from '@udecode/plate-core';\n\nconst deserializeHtmlBold = [{\n  validNodeName: ['STRONG', 'B']\n}, {\n  validStyle: {\n    fontWeight: ['600', '700', 'bold']\n  }\n}];\n\nconst MARK_BOLD = 'bold';\n/**\n * Enables support for bold formatting\n */\n\nconst createBoldPlugin = createPluginFactory({\n  key: MARK_BOLD,\n  isLeaf: true,\n  deserializeHtml: deserializeHtmlBold,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+b'\n  }\n});\n\nconst MARK_CODE = 'code';\n/**\n * Enables support for code formatting\n */\n\nconst createCodePlugin = createPluginFactory({\n  key: MARK_CODE,\n  isLeaf: true,\n  deserializeHtml: [{\n    validNodeName: ['CODE'],\n    query: el => !findHtmlParentElement(el, 'PRE')\n  }, {\n    validStyle: {\n      wordWrap: 'break-word'\n    }\n  }, {\n    validStyle: {\n      fontFamily: 'Consolas'\n    }\n  }],\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+e'\n  }\n});\n\nconst deserializeHtmlItalic = [{\n  validNodeName: ['EM', 'I']\n}, {\n  validStyle: {\n    fontStyle: 'italic'\n  }\n}];\n\nconst MARK_ITALIC = 'italic';\n/**\n * Enables support for italic formatting.\n */\n\nconst createItalicPlugin = createPluginFactory({\n  key: MARK_ITALIC,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+i'\n  },\n  deserializeHtml: deserializeHtmlItalic\n});\n\nconst MARK_STRIKETHROUGH = 'strikethrough';\n/**\n * Enables support for strikethrough formatting.\n */\n\nconst createStrikethroughPlugin = createPluginFactory({\n  key: MARK_STRIKETHROUGH,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+shift+x'\n  },\n  deserializeHtml: [{\n    validNodeName: ['S', 'DEL', 'STRIKE']\n  }, {\n    validStyle: {\n      textDecoration: 'line-through'\n    }\n  }]\n});\n\nconst MARK_SUBSCRIPT$1 = 'subscript';\nconst MARK_SUPERSCRIPT$1 = 'superscript';\n/**\n * Enables support for subscript formatting.\n */\n\nconst createSubscriptPlugin = createPluginFactory({\n  key: MARK_SUBSCRIPT$1,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+,',\n    clear: MARK_SUPERSCRIPT$1\n  },\n  deserializeHtml: [{\n    validNodeName: ['SUB']\n  }, {\n    validStyle: {\n      verticalAlign: 'sub'\n    }\n  }]\n});\n\nconst MARK_SUPERSCRIPT = 'superscript';\nconst MARK_SUBSCRIPT = 'subscript';\n/**\n * Enables support for superscript formatting.\n */\n\nconst createSuperscriptPlugin = createPluginFactory({\n  key: MARK_SUPERSCRIPT,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+.',\n    clear: MARK_SUBSCRIPT\n  },\n  deserializeHtml: [{\n    validNodeName: ['SUP']\n  }, {\n    validStyle: {\n      verticalAlign: 'super'\n    }\n  }]\n});\n\nconst MARK_UNDERLINE = 'underline';\n/**\n * Enables support for underline formatting.\n */\n\nconst createUnderlinePlugin = createPluginFactory({\n  key: MARK_UNDERLINE,\n  isLeaf: true,\n  handlers: {\n    onKeyDown: onKeyDownToggleMark\n  },\n  options: {\n    hotkey: 'mod+u'\n  },\n  deserializeHtml: [{\n    validNodeName: ['U']\n  }, {\n    validStyle: {\n      textDecoration: 'underline'\n    }\n  }]\n});\n\n/**\n * Enables support for basic marks:\n * - Bold\n * - Code\n * - Italic\n * - Strikethrough\n * - Subscript\n * - Superscript\n * - Underline\n */\n\nconst createBasicMarksPlugin = createPluginFactory({\n  key: 'basicMarks',\n  plugins: [createBoldPlugin(), createCodePlugin(), createItalicPlugin(), createStrikethroughPlugin(), createSubscriptPlugin(), createSuperscriptPlugin(), createUnderlinePlugin()]\n});\n\nexport { MARK_BOLD, MARK_CODE, MARK_ITALIC, MARK_STRIKETHROUGH, MARK_SUBSCRIPT$1 as MARK_SUBSCRIPT, MARK_SUPERSCRIPT, MARK_UNDERLINE, createBasicMarksPlugin, createBoldPlugin, createCodePlugin, createItalicPlugin, createStrikethroughPlugin, createSubscriptPlugin, createSuperscriptPlugin, createUnderlinePlugin, deserializeHtmlBold, deserializeHtmlItalic };\n//# sourceMappingURL=index.es.js.map\n","import {\n  MARK_BOLD,\n  MARK_CODE,\n  MARK_ITALIC,\n  MARK_STRIKETHROUGH,\n} from '@udecode/plate-basic-marks';\nimport { ELEMENT_BLOCKQUOTE } from '@udecode/plate-block-quote';\nimport { ELEMENT_CODE_BLOCK } from '@udecode/plate-code-block';\nimport { getPluginType, PlateEditor } from '@udecode/plate-core';\nimport {\n  ELEMENT_H1,\n  ELEMENT_H2,\n  ELEMENT_H3,\n  ELEMENT_H4,\n  ELEMENT_H5,\n  ELEMENT_H6,\n} from '@udecode/plate-heading';\nimport { ELEMENT_LINK } from '@udecode/plate-link';\nimport { ELEMENT_LI, ELEMENT_OL, ELEMENT_UL } from '@udecode/plate-list';\nimport { ELEMENT_PARAGRAPH } from '@udecode/plate-paragraph';\nimport markdown from 'remark-parse';\nimport slate from 'remark-slate';\nimport unified from 'unified';\n\n/**\n * Deserialize content from Markdown format to Slate format.\n * `editor` needs\n */\nexport const deserializeMd = (editor: PlateEditor, data: string) => {\n  const tree: any = unified()\n    .use(markdown)\n    .use(slate, {\n      nodeTypes: {\n        paragraph: getPluginType(editor, ELEMENT_PARAGRAPH),\n        block_quote: getPluginType(editor, ELEMENT_BLOCKQUOTE),\n        link: getPluginType(editor, ELEMENT_LINK),\n        inline_code_mark: getPluginType(editor, MARK_CODE),\n        emphasis_mark: getPluginType(editor, MARK_ITALIC),\n        strong_mark: getPluginType(editor, MARK_BOLD),\n        delete_mark: getPluginType(editor, MARK_STRIKETHROUGH),\n        // FIXME: underline, subscript superscript not yet supported by remark-slate\n        // underline: getPluginType(editor, MARK_UNDERLINE),\n        // subscript: getPluginType(editor, MARK_SUBSCRIPT),\n        // superscript: getPluginType(editor, MARK_SUPERSCRIPT),\n        code_block: getPluginType(editor, ELEMENT_CODE_BLOCK),\n        ul_list: getPluginType(editor, ELEMENT_UL),\n        ol_list: getPluginType(editor, ELEMENT_OL),\n        listItem: getPluginType(editor, ELEMENT_LI),\n        heading: {\n          1: getPluginType(editor, ELEMENT_H1),\n          2: getPluginType(editor, ELEMENT_H2),\n          3: getPluginType(editor, ELEMENT_H3),\n          4: getPluginType(editor, ELEMENT_H4),\n          5: getPluginType(editor, ELEMENT_H5),\n          6: getPluginType(editor, ELEMENT_H6),\n        },\n      },\n      linkDestinationKey: 'url',\n    })\n    .processSync(data);\n\n  return tree.result;\n};\n","export function filterBreaklines(item: any): boolean {\n  return !item.text;\n}\n","import { createPluginFactory, isUrl } from '@udecode/plate-core';\nimport { deserializeMd } from './utils';\n\nexport const KEY_DESERIALIZE_MD = 'deserializeMd';\n\nexport const createDeserializeMdPlugin = createPluginFactory({\n  key: KEY_DESERIALIZE_MD,\n  then: (editor) => ({\n    editor: {\n      insertData: {\n        format: 'text/plain',\n        query: ({ data, dataTransfer }) => {\n          const htmlData = dataTransfer.getData('text/html');\n          if (htmlData) return false;\n\n          const { files } = dataTransfer;\n          if (!files?.length) {\n            // if content is simply a URL pass through to not break LinkPlugin\n            if (isUrl(data)) {\n              return false;\n            }\n          }\n          return true;\n        },\n        getFragment: ({ data }) => deserializeMd(editor, data),\n      },\n    },\n  }),\n});\n"]},"metadata":{},"sourceType":"module"}