{"ast":null,"code":"'use strict';\n\nvar utils = require('./utils');\n\nvar numbers = require('./numbers');\n\nmodule.exports = function makeJuiceClient(juiceClient) {\n  juiceClient.ignoredPseudos = ['hover', 'active', 'focus', 'visited', 'link'];\n  juiceClient.widthElements = ['TABLE', 'TD', 'TH', 'IMG'];\n  juiceClient.heightElements = ['TABLE', 'TD', 'TH', 'IMG'];\n  juiceClient.tableElements = ['TABLE', 'TH', 'TR', 'TD', 'CAPTION', 'COLGROUP', 'COL', 'THEAD', 'TBODY', 'TFOOT'];\n  juiceClient.nonVisualElements = ['HEAD', 'TITLE', 'BASE', 'LINK', 'STYLE', 'META', 'SCRIPT', 'NOSCRIPT'];\n  juiceClient.styleToAttribute = {\n    'background-color': 'bgcolor',\n    'background-image': 'background',\n    'text-align': 'align',\n    'vertical-align': 'valign'\n  };\n  juiceClient.excludedProperties = [];\n  juiceClient.juiceDocument = juiceDocument;\n  juiceClient.inlineDocument = inlineDocument;\n\n  function inlineDocument($, css, options) {\n    options = options || {};\n    var rules = utils.parseCSS(css);\n    var editedElements = [];\n    var styleAttributeName = 'style';\n    var counters = {};\n\n    if (options.styleAttributeName) {\n      styleAttributeName = options.styleAttributeName;\n    }\n\n    rules.forEach(handleRule);\n    editedElements.forEach(setStyleAttrs);\n\n    if (options.inlinePseudoElements) {\n      editedElements.forEach(inlinePseudoElements);\n    }\n\n    if (options.applyWidthAttributes) {\n      editedElements.forEach(function (el) {\n        setDimensionAttrs(el, 'width');\n      });\n    }\n\n    if (options.applyHeightAttributes) {\n      editedElements.forEach(function (el) {\n        setDimensionAttrs(el, 'height');\n      });\n    }\n\n    if (options.applyAttributesTableElements) {\n      editedElements.forEach(setAttributesOnTableElements);\n    }\n\n    if (options.insertPreservedExtraCss && options.extraCss) {\n      var preservedText = utils.getPreservedText(options.extraCss, {\n        mediaQueries: options.preserveMediaQueries,\n        fontFaces: options.preserveFontFaces,\n        keyFrames: options.preserveKeyFrames\n      });\n\n      if (preservedText) {\n        var $appendTo = null;\n\n        if (options.insertPreservedExtraCss !== true) {\n          $appendTo = $(options.insertPreservedExtraCss);\n        } else {\n          $appendTo = $('head');\n\n          if (!$appendTo.length) {\n            $appendTo = $('body');\n          }\n\n          if (!$appendTo.length) {\n            $appendTo = $.root();\n          }\n        }\n\n        $appendTo.first().append('<style>' + preservedText + '</style>');\n      }\n    }\n\n    function handleRule(rule) {\n      var sel = rule[0];\n      var style = rule[1];\n      var selector = new utils.Selector(sel);\n      var parsedSelector = selector.parsed();\n\n      if (!parsedSelector) {\n        return;\n      }\n\n      var pseudoElementType = getPseudoElementType(parsedSelector); // skip rule if the selector has any pseudos which are ignored\n\n      for (var i = 0; i < parsedSelector.length; ++i) {\n        var subSel = parsedSelector[i];\n\n        if (subSel.pseudos) {\n          for (var j = 0; j < subSel.pseudos.length; ++j) {\n            var subSelPseudo = subSel.pseudos[j];\n\n            if (juiceClient.ignoredPseudos.indexOf(subSelPseudo.name) >= 0) {\n              return;\n            }\n          }\n        }\n      }\n\n      if (pseudoElementType) {\n        var last = parsedSelector[parsedSelector.length - 1];\n        var pseudos = last.pseudos;\n        last.pseudos = filterElementPseudos(last.pseudos);\n        sel = parsedSelector.toString();\n        last.pseudos = pseudos;\n      }\n\n      var els;\n\n      try {\n        els = $(sel);\n      } catch (err) {\n        // skip invalid selector\n        return;\n      }\n\n      els.each(function () {\n        var el = this;\n\n        if (el.name && juiceClient.nonVisualElements.indexOf(el.name.toUpperCase()) >= 0) {\n          return;\n        }\n\n        if (pseudoElementType) {\n          var pseudoElPropName = 'pseudo' + pseudoElementType;\n          var pseudoEl = el[pseudoElPropName];\n\n          if (!pseudoEl) {\n            pseudoEl = el[pseudoElPropName] = $('<span />').get(0);\n            pseudoEl.pseudoElementType = pseudoElementType;\n            pseudoEl.pseudoElementParent = el;\n            pseudoEl.counterProps = el.counterProps;\n            el[pseudoElPropName] = pseudoEl;\n          }\n\n          el = pseudoEl;\n        }\n\n        if (!el.styleProps) {\n          el.styleProps = {}; // if the element has inline styles, fake selector with topmost specificity\n\n          if ($(el).attr(styleAttributeName)) {\n            var cssText = '* { ' + $(el).attr(styleAttributeName) + ' } ';\n            addProps(utils.parseCSS(cssText)[0][1], new utils.Selector('<style>', true));\n          } // store reference to an element we need to compile style=\"\" attr for\n\n\n          editedElements.push(el);\n        }\n\n        if (!el.counterProps) {\n          el.counterProps = el.parent && el.parent.counterProps ? Object.create(el.parent.counterProps) : {};\n        }\n\n        function resetCounter(el, value) {\n          var tokens = value.split(/\\s+/);\n\n          for (var j = 0; j < tokens.length; j++) {\n            var counter = tokens[j];\n            var resetval = parseInt(tokens[j + 1], 10);\n            isNaN(resetval) ? el.counterProps[counter] = counters[counter] = 0 : el.counterProps[counter] = counters[tokens[j++]] = resetval;\n          }\n        }\n\n        function incrementCounter(el, value) {\n          var tokens = value.split(/\\s+/);\n\n          for (var j = 0; j < tokens.length; j++) {\n            var counter = tokens[j];\n\n            if (el.counterProps[counter] === undefined) {\n              continue;\n            }\n\n            var incrval = parseInt(tokens[j + 1], 10);\n            isNaN(incrval) ? el.counterProps[counter] = counters[counter] += 1 : el.counterProps[counter] = counters[tokens[j++]] += incrval;\n          }\n        } // go through the properties\n\n\n        function addProps(style, selector) {\n          for (var i = 0, l = style.length; i < l; i++) {\n            if (style[i].type == 'property') {\n              var name = style[i].name;\n              var value = style[i].value;\n\n              if (name === 'counter-reset') {\n                resetCounter(el, value);\n              }\n\n              if (name === 'counter-increment') {\n                incrementCounter(el, value);\n              }\n\n              var important = value.match(/!important$/) !== null;\n              if (important && !options.preserveImportant) value = removeImportant(value); // adds line number and column number for the properties as \"additionalPriority\" to the\n              // properties because in CSS the position directly affect the priority.\n\n              var additionalPriority = [style[i].position.start.line, style[i].position.start.col];\n              var prop = new utils.Property(name, value, selector, important ? 2 : 0, additionalPriority);\n              var existing = el.styleProps[name]; // if property name is not in the excluded properties array\n\n              if (juiceClient.excludedProperties.indexOf(name) < 0) {\n                if (existing && existing.compare(prop) === prop || !existing) {\n                  // deleting a property let us change the order (move it to the end in the setStyleAttrs loop)\n                  if (existing && existing.selector !== selector) {\n                    delete el.styleProps[name];\n                  } else if (existing) {\n                    // make \"prop\" a special composed property.\n                    prop.nextProp = existing;\n                  }\n\n                  el.styleProps[name] = prop;\n                }\n              }\n            }\n          }\n        }\n\n        addProps(style, selector);\n      });\n    }\n\n    function setStyleAttrs(el) {\n      var l = Object.keys(el.styleProps).length;\n      var props = []; // Here we loop each property and make sure to \"expand\"\n      // linked \"nextProp\" properties happening when the same property\n      // is declared multiple times in the same selector.\n\n      Object.keys(el.styleProps).forEach(function (key) {\n        var np = el.styleProps[key];\n\n        while (typeof np !== 'undefined') {\n          props.push(np);\n          np = np.nextProp;\n        }\n      }); // sort properties by their originating selector's specificity so that\n      // props like \"padding\" and \"padding-bottom\" are resolved as expected.\n\n      props.sort(function (a, b) {\n        return a.compareFunc(b);\n      });\n      var string = props.filter(function (prop) {\n        // Content becomes the innerHTML of pseudo elements, not used as a\n        // style property\n        return prop.prop !== 'content';\n      }).map(function (prop) {\n        return prop.prop + ': ' + prop.value.replace(/[\"]/g, '\\'') + ';';\n      }).join(' ');\n\n      if (string) {\n        $(el).attr(styleAttributeName, string);\n      }\n    }\n\n    function inlinePseudoElements(el) {\n      if (el.pseudoElementType && el.styleProps.content) {\n        var parsed = parseContent(el);\n\n        if (parsed.img) {\n          el.name = 'img';\n          $(el).attr('src', parsed.img);\n        } else {\n          $(el).text(parsed);\n        }\n\n        var parent = el.pseudoElementParent;\n\n        if (el.pseudoElementType === 'before') {\n          $(parent).prepend(el);\n        } else {\n          $(parent).append(el);\n        }\n      }\n    }\n\n    function setDimensionAttrs(el, dimension) {\n      if (!el.name) {\n        return;\n      }\n\n      var elName = el.name.toUpperCase();\n\n      if (juiceClient[dimension + 'Elements'].indexOf(elName) > -1) {\n        for (var i in el.styleProps) {\n          if (el.styleProps[i].prop === dimension) {\n            var value = el.styleProps[i].value;\n\n            if (options.preserveImportant) {\n              value = removeImportant(value);\n            }\n\n            if (value.match(/px/)) {\n              var pxSize = value.replace('px', '');\n              $(el).attr(dimension, pxSize);\n              return;\n            }\n\n            if (juiceClient.tableElements.indexOf(elName) > -1 && value.match(/\\%/)) {\n              $(el).attr(dimension, value);\n              return;\n            }\n          }\n        }\n      }\n    }\n\n    function extractBackgroundUrl(value) {\n      return value.indexOf('url(') !== 0 ? value : value.replace(/^url\\(([\"'])?([^\"']+)\\1\\)$/, '$2');\n    }\n\n    function setAttributesOnTableElements(el) {\n      if (!el.name) {\n        return;\n      }\n\n      var elName = el.name.toUpperCase();\n      var styleProps = Object.keys(juiceClient.styleToAttribute);\n\n      if (juiceClient.tableElements.indexOf(elName) > -1) {\n        for (var i in el.styleProps) {\n          if (styleProps.indexOf(el.styleProps[i].prop) > -1) {\n            var prop = juiceClient.styleToAttribute[el.styleProps[i].prop];\n            var value = el.styleProps[i].value;\n\n            if (options.preserveImportant) {\n              value = removeImportant(value);\n            }\n\n            if (prop === 'background') {\n              value = extractBackgroundUrl(value);\n            }\n\n            if (/(linear|radial)-gradient\\(/i.test(value)) {\n              continue;\n            }\n\n            $(el).attr(prop, value);\n          }\n        }\n      }\n    }\n  }\n\n  function removeImportant(value) {\n    return value.replace(/\\s*!important$/, '');\n  }\n\n  function findVariableValue(el, variable) {\n    while (el) {\n      if (variable in el.styleProps) {\n        return el.styleProps[variable].value;\n      }\n\n      var el = el.parent || el.pseudoElementParent;\n    }\n  }\n\n  function applyCounterStyle(counter, style) {\n    switch (style) {\n      case 'lower-roman':\n        return numbers.romanize(counter).toLowerCase();\n\n      case 'upper-roman':\n        return numbers.romanize(counter);\n\n      case 'lower-latin':\n      case 'lower-alpha':\n        return numbers.alphanumeric(counter).toLowerCase();\n\n      case 'upper-latin':\n      case 'upper-alpha':\n        return numbers.alphanumeric(counter);\n      // TODO support more counter styles\n\n      default:\n        return counter.toString();\n    }\n  }\n\n  function parseContent(el) {\n    var content = el.styleProps.content.value;\n\n    if (content === 'none' || content === 'normal') {\n      return '';\n    }\n\n    var imageUrlMatch = content.match(/^\\s*url\\s*\\(\\s*(.*?)\\s*\\)\\s*$/i);\n\n    if (imageUrlMatch) {\n      var url = imageUrlMatch[1].replace(/^['\"]|['\"]$/g, '');\n      return {\n        img: url\n      };\n    }\n\n    var parsed = [];\n    var tokens = content.split(/['\"]/);\n\n    for (var i = 0; i < tokens.length; i++) {\n      if (tokens[i] === '') continue;\n      var varMatch = tokens[i].match(/var\\s*\\(\\s*(.*?)\\s*(,\\s*(.*?)\\s*)?\\s*\\)/i);\n\n      if (varMatch) {\n        var variable = findVariableValue(el, varMatch[1]) || varMatch[2];\n        parsed.push(variable.replace(/^['\"]|['\"]$/g, ''));\n        continue;\n      }\n\n      var counterMatch = tokens[i].match(/counter\\s*\\(\\s*(.*?)\\s*(,\\s*(.*?)\\s*)?\\s*\\)/i);\n\n      if (counterMatch && counterMatch[1] in el.counterProps) {\n        var counter = el.counterProps[counterMatch[1]];\n        parsed.push(applyCounterStyle(counter, counterMatch[3]));\n        continue;\n      }\n\n      var attrMatch = tokens[i].match(/attr\\s*\\(\\s*(.*?)\\s*\\)/i);\n\n      if (attrMatch) {\n        var attr = attrMatch[1];\n        parsed.push(el.pseudoElementParent ? el.pseudoElementParent.attribs[attr] : el.attribs[attr]);\n        continue;\n      }\n\n      parsed.push(tokens[i]);\n    }\n\n    content = parsed.join(''); // Naive unescape, assume no unicode char codes\n\n    content = content.replace(/\\\\/g, '');\n    return content;\n  } // Return \"before\" or \"after\" if the given selector is a pseudo element (e.g.,\n  // a::after).\n\n\n  function getPseudoElementType(selector) {\n    if (selector.length === 0) {\n      return;\n    }\n\n    var pseudos = selector[selector.length - 1].pseudos;\n\n    if (!pseudos) {\n      return;\n    }\n\n    for (var i = 0; i < pseudos.length; i++) {\n      if (isPseudoElementName(pseudos[i])) {\n        return pseudos[i].name;\n      }\n    }\n  }\n\n  function isPseudoElementName(pseudo) {\n    return pseudo.name === 'before' || pseudo.name === 'after';\n  }\n\n  function filterElementPseudos(pseudos) {\n    return pseudos.filter(function (pseudo) {\n      return !isPseudoElementName(pseudo);\n    });\n  }\n\n  function juiceDocument($, options) {\n    options = utils.getDefaultOptions(options);\n    var css = extractCssFromDocument($, options);\n    css += '\\n' + options.extraCss;\n    inlineDocument($, css, options);\n    return $;\n  }\n\n  function getStylesData($, options) {\n    var results = [];\n    var stylesList = $('style');\n    var styleDataList, styleData, styleElement;\n    stylesList.each(function () {\n      styleElement = this; // the API for Cheerio using parse5 (default) and htmlparser2 are slightly different\n      // detect this by checking if .childNodes exist (as opposed to .children)\n\n      var usingParse5 = !!styleElement.childNodes;\n      styleDataList = usingParse5 ? styleElement.childNodes : styleElement.children;\n\n      if (styleDataList.length !== 1) {\n        if (options.removeStyleTags) {\n          $(styleElement).remove();\n        }\n\n        return;\n      }\n\n      styleData = styleDataList[0].data;\n\n      if (options.applyStyleTags && $(styleElement).attr('data-embed') === undefined) {\n        results.push(styleData);\n      }\n\n      if (options.removeStyleTags && $(styleElement).attr('data-embed') === undefined) {\n        var text = usingParse5 ? styleElement.childNodes[0].nodeValue : styleElement.children[0].data;\n        var preservedText = utils.getPreservedText(text, {\n          mediaQueries: options.preserveMediaQueries,\n          fontFaces: options.preserveFontFaces,\n          keyFrames: options.preserveKeyFrames,\n          pseudos: options.preservePseudos\n        }, juiceClient.ignoredPseudos);\n\n        if (preservedText) {\n          if (usingParse5) {\n            styleElement.childNodes[0].nodeValue = preservedText;\n          } else {\n            styleElement.children[0].data = preservedText;\n          }\n        } else {\n          $(styleElement).remove();\n        }\n      }\n\n      $(styleElement).removeAttr('data-embed');\n    });\n    return results;\n  }\n\n  function extractCssFromDocument($, options) {\n    var results = getStylesData($, options);\n    var css = results.join('\\n');\n    return css;\n  }\n\n  return juiceClient;\n};","map":{"version":3,"sources":["/Users/hyun/Desktop/vmvmvmvm/frontend/node_modules/juice/lib/inline.js"],"names":["utils","require","numbers","module","exports","makeJuiceClient","juiceClient","ignoredPseudos","widthElements","heightElements","tableElements","nonVisualElements","styleToAttribute","excludedProperties","juiceDocument","inlineDocument","$","css","options","rules","parseCSS","editedElements","styleAttributeName","counters","forEach","handleRule","setStyleAttrs","inlinePseudoElements","applyWidthAttributes","el","setDimensionAttrs","applyHeightAttributes","applyAttributesTableElements","setAttributesOnTableElements","insertPreservedExtraCss","extraCss","preservedText","getPreservedText","mediaQueries","preserveMediaQueries","fontFaces","preserveFontFaces","keyFrames","preserveKeyFrames","$appendTo","length","root","first","append","rule","sel","style","selector","Selector","parsedSelector","parsed","pseudoElementType","getPseudoElementType","i","subSel","pseudos","j","subSelPseudo","indexOf","name","last","filterElementPseudos","toString","els","err","each","toUpperCase","pseudoElPropName","pseudoEl","get","pseudoElementParent","counterProps","styleProps","attr","cssText","addProps","push","parent","Object","create","resetCounter","value","tokens","split","counter","resetval","parseInt","isNaN","incrementCounter","undefined","incrval","l","type","important","match","preserveImportant","removeImportant","additionalPriority","position","start","line","col","prop","Property","existing","compare","nextProp","keys","props","key","np","sort","a","b","compareFunc","string","filter","map","replace","join","content","parseContent","img","text","prepend","dimension","elName","pxSize","extractBackgroundUrl","test","findVariableValue","variable","applyCounterStyle","romanize","toLowerCase","alphanumeric","imageUrlMatch","url","varMatch","counterMatch","attrMatch","attribs","isPseudoElementName","pseudo","getDefaultOptions","extractCssFromDocument","getStylesData","results","stylesList","styleDataList","styleData","styleElement","usingParse5","childNodes","children","removeStyleTags","remove","data","applyStyleTags","nodeValue","preservePseudos","removeAttr"],"mappings":"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","sourcesContent":["'use strict';\n\nvar utils = require('./utils');\nvar numbers = require('./numbers');\n\nmodule.exports = function makeJuiceClient(juiceClient) {\n\njuiceClient.ignoredPseudos = ['hover', 'active', 'focus', 'visited', 'link'];\njuiceClient.widthElements = ['TABLE', 'TD', 'TH', 'IMG'];\njuiceClient.heightElements = ['TABLE', 'TD', 'TH', 'IMG'];\njuiceClient.tableElements = ['TABLE', 'TH', 'TR', 'TD', 'CAPTION', 'COLGROUP', 'COL', 'THEAD', 'TBODY', 'TFOOT'];\njuiceClient.nonVisualElements = [ 'HEAD', 'TITLE', 'BASE', 'LINK', 'STYLE', 'META', 'SCRIPT', 'NOSCRIPT' ];\njuiceClient.styleToAttribute = {\n  'background-color': 'bgcolor',\n  'background-image': 'background',\n  'text-align': 'align',\n  'vertical-align': 'valign'\n};\njuiceClient.excludedProperties = [];\n\njuiceClient.juiceDocument = juiceDocument;\njuiceClient.inlineDocument = inlineDocument;\n\nfunction inlineDocument($, css, options) {\n\n  options = options || {};\n  var rules = utils.parseCSS(css);\n  var editedElements = [];\n  var styleAttributeName = 'style';\n  var counters = {};\n\n  if (options.styleAttributeName) {\n    styleAttributeName = options.styleAttributeName;\n  }\n\n  rules.forEach(handleRule);\n  editedElements.forEach(setStyleAttrs);\n\n  if (options.inlinePseudoElements) {\n    editedElements.forEach(inlinePseudoElements);\n  }\n\n  if (options.applyWidthAttributes) {\n    editedElements.forEach(function(el) {\n      setDimensionAttrs(el, 'width');\n    });\n  }\n\n  if (options.applyHeightAttributes) {\n    editedElements.forEach(function(el) {\n      setDimensionAttrs(el, 'height');\n    });\n  }\n\n  if (options.applyAttributesTableElements) {\n    editedElements.forEach(setAttributesOnTableElements);\n  }\n\n  if (options.insertPreservedExtraCss && options.extraCss) {\n    var preservedText = utils.getPreservedText(options.extraCss, {\n      mediaQueries: options.preserveMediaQueries,\n      fontFaces: options.preserveFontFaces,\n      keyFrames: options.preserveKeyFrames\n    });\n    if (preservedText) {\n      var $appendTo = null;\n      if (options.insertPreservedExtraCss !== true) {\n        $appendTo = $(options.insertPreservedExtraCss);\n      } else {\n        $appendTo = $('head');\n        if (!$appendTo.length) { $appendTo = $('body'); }\n        if (!$appendTo.length) { $appendTo = $.root(); }\n      }\n\n      $appendTo.first().append('<style>' + preservedText + '</style>');\n    }\n  }\n\n  function handleRule(rule) {\n    var sel = rule[0];\n    var style = rule[1];\n    var selector = new utils.Selector(sel);\n    var parsedSelector = selector.parsed();\n\n    if (!parsedSelector) {\n      return;\n    }\n\n    var pseudoElementType = getPseudoElementType(parsedSelector);\n\n    // skip rule if the selector has any pseudos which are ignored\n    for (var i = 0; i < parsedSelector.length; ++i) {\n      var subSel = parsedSelector[i];\n      if (subSel.pseudos) {\n        for (var j = 0; j < subSel.pseudos.length; ++j) {\n          var subSelPseudo = subSel.pseudos[j];\n          if (juiceClient.ignoredPseudos.indexOf(subSelPseudo.name) >= 0) {\n            return;\n          }\n        }\n      }\n    }\n\n    if (pseudoElementType) {\n      var last = parsedSelector[parsedSelector.length - 1];\n      var pseudos = last.pseudos;\n      last.pseudos = filterElementPseudos(last.pseudos);\n      sel = parsedSelector.toString();\n      last.pseudos = pseudos;\n    }\n\n    var els;\n    try {\n      els = $(sel);\n    } catch (err) {\n      // skip invalid selector\n      return;\n    }\n\n    els.each(function() {\n      var el = this;\n\n      if (el.name && juiceClient.nonVisualElements.indexOf(el.name.toUpperCase()) >= 0) {\n        return;\n      }\n\n      if (pseudoElementType) {\n        var pseudoElPropName = 'pseudo' + pseudoElementType;\n        var pseudoEl = el[pseudoElPropName];\n        if (!pseudoEl) {\n          pseudoEl = el[pseudoElPropName] = $('<span />').get(0);\n          pseudoEl.pseudoElementType = pseudoElementType;\n          pseudoEl.pseudoElementParent = el;\n          pseudoEl.counterProps = el.counterProps;\n          el[pseudoElPropName] = pseudoEl;\n        }\n        el = pseudoEl;\n      }\n\n      if (!el.styleProps) {\n        el.styleProps = {};\n\n        // if the element has inline styles, fake selector with topmost specificity\n        if ($(el).attr(styleAttributeName)) {\n          var cssText = '* { ' + $(el).attr(styleAttributeName) + ' } ';\n          addProps(utils.parseCSS(cssText)[0][1], new utils.Selector('<style>', true));\n        }\n\n        // store reference to an element we need to compile style=\"\" attr for\n        editedElements.push(el);\n      }\n\n      if (!el.counterProps) {\n        el.counterProps = el.parent && el.parent.counterProps\n          ? Object.create(el.parent.counterProps)\n          : {};\n      }\n\n      function resetCounter(el, value) {\n        var tokens = value.split(/\\s+/);\n\n        for (var j = 0; j < tokens.length; j++) {\n          var counter = tokens[j];\n          var resetval = parseInt(tokens[j+1], 10);\n\n          isNaN(resetval)\n            ? el.counterProps[counter] = counters[counter] = 0\n            : el.counterProps[counter] = counters[tokens[j++]] = resetval;\n        }\n      }\n\n      function incrementCounter(el, value) {\n        var tokens = value.split(/\\s+/);\n\n        for (var j = 0; j < tokens.length; j++) {\n          var counter = tokens[j];\n\n          if (el.counterProps[counter] === undefined) {\n            continue;\n          }\n\n          var incrval = parseInt(tokens[j+1], 10);\n\n          isNaN(incrval)\n            ? el.counterProps[counter] = counters[counter] += 1\n            : el.counterProps[counter] = counters[tokens[j++]] += incrval;\n        }\n      }\n\n      // go through the properties\n      function addProps(style, selector) {\n        for (var i = 0, l = style.length; i < l; i++) {\n          if (style[i].type == 'property') {\n            var name = style[i].name;\n            var value = style[i].value;\n\n            if (name === 'counter-reset') {\n              resetCounter(el, value);\n            }\n\n            if (name === 'counter-increment') {\n              incrementCounter(el, value);\n            }\n\n            var important = value.match(/!important$/) !== null;\n            if (important && !options.preserveImportant) value = removeImportant(value);\n            // adds line number and column number for the properties as \"additionalPriority\" to the\n            // properties because in CSS the position directly affect the priority.\n            var additionalPriority = [style[i].position.start.line, style[i].position.start.col];\n            var prop = new utils.Property(name, value, selector, important ? 2 : 0, additionalPriority);\n            var existing = el.styleProps[name];\n\n            // if property name is not in the excluded properties array\n            if (juiceClient.excludedProperties.indexOf(name) < 0) {\n              if (existing && existing.compare(prop) === prop || !existing) {\n                // deleting a property let us change the order (move it to the end in the setStyleAttrs loop)\n                if (existing && existing.selector !== selector) {\n                  delete el.styleProps[name];\n                } else if (existing) {\n                  // make \"prop\" a special composed property.\n                  prop.nextProp = existing;\n                }\n\n                el.styleProps[name] = prop;\n              }\n            }\n          }\n        }\n      }\n\n      addProps(style, selector);\n    });\n  }\n\n  function setStyleAttrs(el) {\n    var l = Object.keys(el.styleProps).length;\n    var props = [];\n    // Here we loop each property and make sure to \"expand\"\n    // linked \"nextProp\" properties happening when the same property\n    // is declared multiple times in the same selector.\n    Object.keys(el.styleProps).forEach(function(key) {\n      var np = el.styleProps[key];\n      while (typeof np !== 'undefined') {\n        props.push(np);\n        np = np.nextProp;\n      }\n    });\n    // sort properties by their originating selector's specificity so that\n    // props like \"padding\" and \"padding-bottom\" are resolved as expected.\n    props.sort(function(a, b) {\n      return a.compareFunc(b);\n    });\n    var string = props\n      .filter(function(prop) {\n        // Content becomes the innerHTML of pseudo elements, not used as a\n        // style property\n        return prop.prop !== 'content';\n      })\n      .map(function(prop) {\n        return prop.prop + ': ' + prop.value.replace(/[\"]/g, '\\'') + ';';\n      })\n      .join(' ');\n    if (string) {\n      $(el).attr(styleAttributeName, string);\n    }\n  }\n\n  function inlinePseudoElements(el) {\n    if (el.pseudoElementType && el.styleProps.content) {\n      var parsed = parseContent(el);\n      if (parsed.img) {\n        el.name = 'img';\n        $(el).attr('src', parsed.img);\n      } else {\n        $(el).text(parsed);\n      }\n      var parent = el.pseudoElementParent;\n      if (el.pseudoElementType === 'before') {\n        $(parent).prepend(el);\n      } else {\n        $(parent).append(el);\n      }\n    }\n  }\n\n  function setDimensionAttrs(el, dimension) {\n    if (!el.name) { return; }\n    var elName = el.name.toUpperCase();\n    if (juiceClient[dimension + 'Elements'].indexOf(elName) > -1) {\n      for (var i in el.styleProps) {\n        if (el.styleProps[i].prop === dimension) {\n          var value = el.styleProps[i].value;\n          if (options.preserveImportant) {\n            value = removeImportant(value);\n          }\n          if (value.match(/px/)) {\n            var pxSize = value.replace('px', '');\n            $(el).attr(dimension, pxSize);\n            return;\n          }\n          if (juiceClient.tableElements.indexOf(elName) > -1 && value.match(/\\%/)) {\n            $(el).attr(dimension, value);\n            return;\n          }\n        }\n      }\n    }\n  }\n\n  function extractBackgroundUrl(value) {\n    return value.indexOf('url(') !== 0\n      ? value\n      : value.replace(/^url\\(([\"'])?([^\"']+)\\1\\)$/, '$2');\n  }\n\n  function setAttributesOnTableElements(el) {\n    if (!el.name) { return; }\n    var elName = el.name.toUpperCase();\n    var styleProps = Object.keys(juiceClient.styleToAttribute);\n\n    if (juiceClient.tableElements.indexOf(elName) > -1) {\n      for (var i in el.styleProps) {\n        if (styleProps.indexOf(el.styleProps[i].prop) > -1) {\n          var prop = juiceClient.styleToAttribute[el.styleProps[i].prop];\n          var value = el.styleProps[i].value;\n          if (options.preserveImportant) {\n            value = removeImportant(value);\n          }\n          if (prop === 'background') {\n            value = extractBackgroundUrl(value);\n          }\n          if (/(linear|radial)-gradient\\(/i.test(value)) {\n            continue;\n          }\n          $(el).attr(prop, value);\n        }\n      }\n    }\n  }\n}\n\nfunction removeImportant(value) {\n  return value.replace(/\\s*!important$/, '')\n}\n\nfunction findVariableValue(el, variable) {\n  while (el) {\n    if (variable in el.styleProps) {\n      return el.styleProps[variable].value;\n    }\n\n    var el = el.parent || el.pseudoElementParent;\n  }\n}\n\nfunction applyCounterStyle(counter, style) {\n  switch (style) {\n    case 'lower-roman':\n      return numbers.romanize(counter).toLowerCase();\n    case 'upper-roman':\n      return numbers.romanize(counter);\n    case 'lower-latin':\n    case 'lower-alpha':\n      return numbers.alphanumeric(counter).toLowerCase();\n    case 'upper-latin':\n    case 'upper-alpha':\n      return numbers.alphanumeric(counter);\n    // TODO support more counter styles\n    default:\n      return counter.toString();\n  }\n}\n\nfunction parseContent(el) {\n  var content = el.styleProps.content.value;\n\n  if (content === 'none' || content === 'normal') {\n    return '';\n  }\n\n  var imageUrlMatch = content.match(/^\\s*url\\s*\\(\\s*(.*?)\\s*\\)\\s*$/i);\n  if (imageUrlMatch) {\n    var url = imageUrlMatch[1].replace(/^['\"]|['\"]$/g, '');\n    return { img: url };\n  }\n\n  var parsed = [];\n\n  var tokens = content.split(/['\"]/);\n  for (var i = 0; i < tokens.length; i++) {\n    if (tokens[i] === '') continue;\n\n    var varMatch = tokens[i].match(/var\\s*\\(\\s*(.*?)\\s*(,\\s*(.*?)\\s*)?\\s*\\)/i);\n    if (varMatch) {\n      var variable = findVariableValue(el, varMatch[1]) || varMatch[2];\n      parsed.push(variable.replace(/^['\"]|['\"]$/g, ''));\n      continue;\n    }\n\n    var counterMatch = tokens[i].match(/counter\\s*\\(\\s*(.*?)\\s*(,\\s*(.*?)\\s*)?\\s*\\)/i);\n    if (counterMatch && counterMatch[1] in el.counterProps) {\n      var counter = el.counterProps[counterMatch[1]];\n      parsed.push(applyCounterStyle(counter, counterMatch[3]));\n      continue;\n    }\n\n    var attrMatch = tokens[i].match(/attr\\s*\\(\\s*(.*?)\\s*\\)/i);\n    if (attrMatch) {\n      var attr = attrMatch[1];\n      parsed.push(el.pseudoElementParent\n        ? el.pseudoElementParent.attribs[attr]\n        : el.attribs[attr]\n      );\n      continue;\n    }\n\n    parsed.push(tokens[i]);\n  }\n\n  content = parsed.join('');\n  // Naive unescape, assume no unicode char codes\n  content = content.replace(/\\\\/g, '');\n  return content;\n}\n\n// Return \"before\" or \"after\" if the given selector is a pseudo element (e.g.,\n// a::after).\nfunction getPseudoElementType(selector) {\n  if (selector.length === 0) {\n    return;\n  }\n\n  var pseudos = selector[selector.length - 1].pseudos;\n  if (!pseudos) {\n    return;\n  }\n\n  for (var i = 0; i < pseudos.length; i++) {\n    if (isPseudoElementName(pseudos[i])) {\n      return pseudos[i].name;\n    }\n  }\n}\n\nfunction isPseudoElementName(pseudo) {\n  return pseudo.name === 'before' || pseudo.name === 'after';\n}\n\nfunction filterElementPseudos(pseudos) {\n  return pseudos.filter(function(pseudo) {\n    return !isPseudoElementName(pseudo);\n  });\n}\n\nfunction juiceDocument($, options) {\n  options = utils.getDefaultOptions(options);\n  var css = extractCssFromDocument($, options);\n  css += '\\n' + options.extraCss;\n  inlineDocument($, css, options);\n  return $;\n}\n\nfunction getStylesData($, options) {\n  var results = [];\n  var stylesList = $('style');\n  var styleDataList, styleData, styleElement;\n  stylesList.each(function() {\n    styleElement = this;\n    // the API for Cheerio using parse5 (default) and htmlparser2 are slightly different\n    // detect this by checking if .childNodes exist (as opposed to .children)\n    var usingParse5 = !!styleElement.childNodes;\n    styleDataList = usingParse5 ? styleElement.childNodes : styleElement.children;\n    if (styleDataList.length !== 1) {\n      if (options.removeStyleTags) {\n        $(styleElement).remove();\n      }\n      return;\n    }\n    styleData = styleDataList[0].data;\n    if (options.applyStyleTags && $(styleElement).attr('data-embed') === undefined) {\n      results.push(styleData);\n    }\n    if (options.removeStyleTags && $(styleElement).attr('data-embed') === undefined) {\n      var text = usingParse5 ? styleElement.childNodes[0].nodeValue : styleElement.children[0].data;\n      var preservedText = utils.getPreservedText(text, {\n        mediaQueries: options.preserveMediaQueries,\n        fontFaces: options.preserveFontFaces,\n        keyFrames: options.preserveKeyFrames,\n        pseudos: options.preservePseudos\n      }, juiceClient.ignoredPseudos);\n      if (preservedText) {\n        if (usingParse5) {\n          styleElement.childNodes[0].nodeValue = preservedText;\n        } else {\n          styleElement.children[0].data = preservedText;\n        }\n      } else {\n        $(styleElement).remove();\n      }\n    }\n    $(styleElement).removeAttr('data-embed');\n  });\n  return results;\n}\n\nfunction extractCssFromDocument($, options) {\n  var results = getStylesData($, options);\n  var css = results.join('\\n');\n  return css;\n}\n\nreturn juiceClient;\n\n};\n"]},"metadata":{},"sourceType":"script"}